# MVVM 패턴 여정기

### :fire: 시작하기 앞서

먼저 내 대표작 [조치원 수호대](https://github.com/tnvnfdla1214/homemade_guardian) 프로젝트 에서 알았던 것 은 나의 개발은 반쪽짜리 개발이였다는 것이였다.
이유는 나와 함께한 [친구](https://github.com/likppi10) 외에는 아마 중간에 들어와서 참여하기에는 어려울 것이다.
이는 객치지향적으로 코드를 짜지 않았기 떄문이다. 당시에는 그것을 몰랐고 버그 잡는것에만 치중했고 기능 구현에만 치중했기 때문이다.
당시에 MVC,MVP,싱글톤,MVVM 등등의 디자인 패턴에 대해 듣긴 했지만 찾아보며 이해해보려 노력해도 정확히 와닿지가 않았기에 넘어갔었다.
하지만 Spring을 이용해보면서 왜 객체지향을 지켜야 하는지, 어떠한 방법이 이를 가능하게 하는지에 대해 이해 하게 되었다.
후에 MVP가 나오고 MVVM이 나와서 어떠한 방식이 바뀌었는지 이번 자료에서 알아보려 한다. 다음장들은 프로젝트를 통해 감을 익히고 ACC를 이용하는 것 또한 해볼 예정이다.

***

먼저 (과거의 나를 포함) 안드로이드 개발을 처음 시작하는 사람들은 대부분 액티비티에 거의 모든 코드를 직접 넣는다. 하지만 시간이 갈수록 액티비티는 점점 무거워지고, 수정이나 유지 보수 하기가 힘들어진다. 흔히 비 구조적이고 유지보수가 어려운 코드를 스파게티 코드하고 하는데, 나의 첫 프로젝트는 스파게티에 라면 사리 다섯 개 정도 추가한 모습과 같았다.

때문에 디자인 패턴 공부의 필요성을 마음 깊이 느끼게 됐다. 이제 인싸 안드로이드 개발자라면 다들 MVVM에 DataBinding, Rx 등등은 숙지하고 있는 것 같다. 낯선 생김새 때문에 쉽사리 입문하기 힘들었지만, 일단 차근차근 하나씩 글을 써가며 연습해보기로 했다. 이 중에서도 MVVM 패턴과, 그것을 쉽게 만들도록 도와주는 안드로이드 아키텍쳐 컴포넌트 에 관한 예제로 시작하려고 한다.

***

### MVVM 패턴이란

위에서 언급한 대로, 액티비티에 기능을 붙이다보면 액티비티가 무거워지거나 혹은 종속성이 너무 강해 테스트가 힘들고 유지보수가 어려워진다. 이런 고민 때문에 MVVM 패턴이 등장했다. MVVM은 View - ViewModel - Model을 이용해 각각의 역할을 분리하여 가독성과 재사용성을 높인 디자인 패턴이다.

***

### MVC와 MVP와 MVVM 차이점

기존 MVC(Model - View - Controller) 구조에서는 액티비티가 컨트롤러의 역할을 했으며, 뷰와 연결되어 유저와 상호작용도 하고, 모델과 연결되어 데이터도 처리했다. 즉 뷰와 모델 사이에서 중재자 역할을 했다.

MVVM에서는 뷰에서 뷰모델로, 뷰모델에서 모델로 작업을 처리하며, 뷰에서 모델을 직접 참조하지 않는다. 대신 뷰에서 뷰모델을 관찰하며 데이터의 변경 사항을 감지한다.
<img src = "https://user-images.githubusercontent.com/48902047/132007881-1dadcdad-663c-4e92-8610-5a4fe25b34ba.jpeg">
<img src = "https://user-images.githubusercontent.com/48902047/131997902-24f601f0-685c-44fa-a48a-cd2aab86797d.png"> 

예를 들어, 유저가 목록에 새로운 아이템을 추가했다.

MVC에서는 컨트롤러가 유저의 클릭 액션을 확인하고, 모델에 데이터를 갱신하도록 요청하고, 뷰에도 화면을 업데이트 하라고 요청을 해야한다. 코딩하다 무언가 빠뜨리면, 때로는 DB만 갱신되고 화면은 갱신되지 않는 경우도 나타난다. 액티비티가 해야 할 역할이 많아 바쁘다.


MVVM에서도 뷰가 유저의 클릭 액션을 확인하지만, 뷰에서 곧바로 DB에 접근하지 않는다. 말 그대로 ‘뷰’이기 때문에 UI를 갱신하는 역할에 충실하다. 대신 뷰모델을 참조하고, 뷰모델에서는 다시 모델에서 잘 정리된 데이터를 참조한다. 또, 뷰는 뷰모델을 관찰(Observe) 한다. DB에 새로운 아이템을 추가한 후에 화면을 업데이트 하라고 직접 명령하지 않아도 된다. 뷰에서는 이미 뷰모델을 관찰하고 있기 때문에 데이터의 변화를 알아차리고 자동으로 화면을 갱신한다.

### MVVM 장점을 요약하자면

1. 뷰가 데이터를 실시간으로 관찰! LiveData, 즉 Observable 패턴을 이용하기 때문에 데이터베이스를 관찰하고 자동으로 UI를 갱신한다. 직접 뷰를 바꾸어주는 번거로움도 없으며 데이터와 불일치할 확률이 줄어든다.


2. 생명주기로부터 안전! 메모리 릭 방지! 뷰모델을 통해 데이터를 참조하기 때문에 액티비티/프래그먼트의 생명주기를 따르지 않는다. 화면전환과 같이 액티비티가 파괴된 후 재구성 되어도 뷰모델이 데이터를 홀드하고 있기 때문에 영향을 받지 않는다. 또한 뷰가 활성화되어있을 경우에만 작동하기 때문에 불필요한 메모리 사용을 줄일 수 있다.


3. 역할 분리! 모듈화! UI, 비즈니스 로직, 데이터베이스가 기능별로 모듈화 되어있어서 역할 별로 정리가 ★☆ 깔-끔 ☆★ 유닛 테스트가 한결 용이해질 것이다. (물론 MVVM도 잘 짜야겠지만 말이다.)

모듈화가 잘 되어있다면 다음과 같은 상황에서 편하게 코딩이 가능할 것 같다.


● 내장 DB를 통째로 바꾸고 싶다고 할 때, 뷰나 다른 코드에 깊게 종속돼있지 않기 때문에 DB만 쓱 교체해주면 된다.

● 뷰모델과 뷰가 1:n 연결이 가능하기 때문에, 뷰모델에 하나의 메소드를 구현해 놓으면 A 액티비티든 B 액티비티든 여러 뷰에서 호출해 재사용하기 편리하다.


단, 예상되는 단점이라면 MVVM 패턴에선 기존에 비해 추가로 만들어주어야 하는 클래스도 많고, 이들을 서로 코딩하여 연결해주어야 한다. 이 과정이 복잡해지면 기존의 프로젝트에 적용하기는 시간적, 인적 자원이 많이 필요할 것 같다.


### 안드로이드 아키텍쳐 컴포넌트

이런 트렌드에 발맞춰, 구글에서는 안드로이드 아키텍쳐 컴포넌트(Android Architecture Components, AAC)를 제공한다. 안드로이드 아키텍쳐 컴포넌트는 앱 구조를 더 튼튼하고, 테스트에 용이하고, 유지 보수성이 뛰어나게 만들어 주는 라이브러리 모음이다. 아키텍쳐 컴포턴트에서는 조금 더 모듈화된 코딩을 돕기 위해 Databinding, LiveData, ViewModel 등의 유용한 라이브러리를 제공하며, 이러한 라이브러리의 모음은 MVVM 패턴의 구조의 설계에 최적화되어 있다.

가이드에 따르면, 훌륭한 Android 앱은 관심사 분리를 해야하고, 모델로부터 UI를 벗어나도록 해야한다. UI나 운영체제의 상호작용을 핸들링하지 않는 어떠한 코드도 Activity나 Fragment에 있으면 안된다. 왜냐하면 Activity나 Fragment를 최대한 클린하게 유지하는 것이 많은 생명주기와 관련된 문제들로부터 벗어날 수 있도록 하기 때문이다. 결국 시스템은 언제든지 Activity나 Fragment를 destroy(생명주기) 할수 있어서 data는 UI로부터 분리된, 결과적으로 생명주기로부터 분리된 model에 의해서 처리되어야 한다.


안드로이드 팀에서 제안한 것을 이해하기 위해서는 Architecture Component의 구성요소를 모두 알아야 한다. 왜냐하면 우리에게 쉬운부분이 아니기 때문이다. Room, ViewModel, LiveData, Lifecycle and Paging의 5가지 구성요소가 있다. 모든 요소들이 각 역할이 있고, 견고한 아키텍처를 만든다. 좀더 이해하기 쉽도록 다이어그램을 같이 보도록 하자.


-> https://cafe.naver.com/tnvnfdla1214
나머지 글은 





